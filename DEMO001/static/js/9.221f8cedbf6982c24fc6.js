webpackJsonp([9],{"0C/6":function(n,t,a){var e=a("gZsE");"string"==typeof e&&(e=[[n.i,e,""]]),e.locals&&(n.exports=e.locals);a("rjj0")("3b704203",e,!0,{})},VXXW:function(n,t,a){"use strict";function e(n){a("0C/6")}Object.defineProperty(t,"__esModule",{value:!0});var i=a("bOdI"),s=a.n(i),r=a("Cz8s"),o=a("Bfwr"),c=a("63CM"),u=a("ODCk"),l=(r.a,o.a,c.a,{name:"locdetail",components:{mHeader:r.a,Loading:o.a},directives:{TransferDom:c.a},computed:{cTitle:function(){return"LocShare"!==this.pageType?this.name+"的定位分享":"我的定位分享"},loadingText:function(){return"地图资源加载中\n请耐心等待..."}},data:function(){var n;return n={pid:this.$route.query.id,unitcode:this.$route.query.unitcode,name:decodeURIComponent(this.$route.query.name),amap:null,ageo:null,loadingMap:!0,pageType:this.$route.name,tabIndex:0,filterIndex:0,showInfo:!1,touchstarty:"",dataCurrentCoord:{},dataCoords:[],currentMarker:null,curMarkers:[],currentMarkerDetail:{},currentPath:null,defaultIcon:null,activeIcon:null,defaultIconOffset:null,activeIconOffset:null,drawcircle:null,touchstartx:null},s()(n,"touchstarty",null),s()(n,"touchendx",null),s()(n,"touchendy",null),s()(n,"cradius",0),s()(n,"mapcircle",null),s()(n,"curAction","move"),n},beforeRouteEnter:function(n,t,a){a()},mounted:function(){var n=this;window.AMap?this.initMap():this.publicApi.remoteLoad("//webapi.amap.com/maps?v=1.4.3&key=305f41fcb370a7a285eaecf07e05bbf6").then(function(){n.publicApi.remoteLoad("//webapi.amap.com/ui/1.0/main.js").then(function(){console.log("载入地图资源成功"),n.initMap()})})},beforeDestroy:function(){if(console.log("销毁地图资源"),this.amap){this.amap.off("touchmove"),this.amap.clearMap(),this.amap=null;var n=document.querySelector("#amap");n&&n.parentNode.removeChild(n)}},methods:{initMap:function(){console.log("地图初始化");var n=this;AMapUI.loadUI(["control/BasicControl","overlay/SimpleMarker"],function(t,a){n.amap=new AMap.Map("amap",{zoom:15}),n.amap.addControl(new t.Zoom({position:"rt"})),n.defaultIcon=new AMap.Icon({size:new AMap.Size(20,20),image:"static/images/pin.png",imageSize:new AMap.Size(20,20)}),n.activeIcon=new AMap.Icon({size:new AMap.Size(39,46.5),image:"static/images/pin-active.png",imageSize:new AMap.Size(39,46.5)}),n.defaultIconOffset=new AMap.Pixel(-10,-10),n.activeIconOffset=new AMap.Pixel(-18,-42),n.amap.on("touchmove",function(t){n.hideInfo()}),n.loadingMap=!1,"LocShare"!==n.pageType?n.initData():n.initLocShare()})},initData:function(){this.getCurrentLoc()},initLocShare:function(){var n=this;n.amap.plugin(["AMap.Geolocation"],function(){n.$store.dispatch("globalLoading",1),n.ageo=new AMap.Geolocation({useNative:!0,enableHighAccuracy:!0,timeout:1e4,maximumAge:0,convert:!0,showButton:!1,buttonPosition:"LT",buttonOffset:new AMap.Pixel(10,20),showMarker:!1,markerOptions:{icon:n.defaultIcon,offset:n.defaultIconOffset},showCircle:!1,panToLocation:!0,zoomToAccuracy:!0}),n.ageo.on("complete",function(t){n.$vux.toast.text("获取定位成功，准备上传"),n.lng=t.position.lng,n.lat=t.position.lat,n.addr=t.formattedAddress,n.updateMarkers([{fixx:n.lng,fixy:n.lat,fixsite:n.addr,fixtime:Object(u.a)(new Date),personname:"Joker"}]),n.$store.dispatch("globalLoading",0)}),n.ageo.on("error",function(t){n.$vux.toast.text("获取定位失败，请打开定位权限后重试"),n.$store.dispatch("globalLoading",0)}),n.loadingMap=!1,n.amap.addControl(n.ageo),setTimeout(function(){n.ageo.getCurrentPosition()},500)})},addMarkerDefault:function(n){var t=this,a=new AMap.Marker({icon:this.defaultIcon,offset:this.defaultIconOffset,position:[n.fixx,n.fixy],extData:n});a.setMap(this.amap),a.on("touchstart",function(n){t.currentMarker=a,t.updateFocus()}),this.curMarkers.push(a)},changeTab:function(n){var t=!0;switch(1===this.tabIndex&&n===this.tabIndex&&(t=!1),this.tabIndex=n,this.tabIndex){case 0:this.getCurrentLoc();break;case 1:t&&this.getHistoryLocs()}},changeFilterDay:function(n){this.filterIndex!==n&&(this.filterIndex=n,this.getHistoryLocs())},updateFocus:function(){this.setMarkerActive(this.currentMarker);for(var n in this.curMarkers)this.curMarkers[n]!==this.currentMarker&&this.setMarkerDefault(this.curMarkers[n]);this.showInfo=!0,this.currentMarkerDetail=this.currentMarker.getExtData()},getTouchStart:function(n){this.touchstarty=n.targetTouches[0].clientY},hideInfo:function(n){if(n){n.targetTouches[0].clientY-this.touchstarty>30&&(this.showInfo=!1,this.setMarkerDefault(this.currentMarker))}else this.showInfo=!1,this.setMarkerDefault(this.currentMarker)},setMarkerActive:function(n){n&&(n.setIcon(this.activeIcon),n.setOffset(this.activeIconOffset))},setMarkerDefault:function(n){n&&(n.setIcon(this.defaultIcon),n.setOffset(this.defaultIconOffset))},getCurrentLoc:function(){var n=this;0===this.tabIndex&&this.publicApi.ajax(this.URL.DETAIL.CURRENTLOC,{id:this.pid},1).then(function(t){if(200===t.data.status){var a=t.data.data.list;a.length>0?n.updateMarkers(a):n.$vux.toast.text("所选部员无实时定位呢")}else n.$vux.toast.text(t.data.message)})},getHistoryLocs:function(){var n=this;this.pid,this.filterIndex;this.publicApi.ajax(this.URL.DETAIL.HISTORYLOC,{},1).then(function(t){200===t.data.status?t.data.data.list.length>0?(n.dataCoords=t.data.data.list,n.updateMarkers(n.dataCoords)):n.$vux.toast.text("当前人员无历史定位"):n.$vux.toast.text(t.data.message)})},updateMarkers:function(n){for(var t in this.curMarkers)this.curMarkers[t].off("touchend"),this.curMarkers[t]=null;this.curMarkers=[],this.currentMarker&&(this.currentMarker.off("touchend"),this.currentMarker=null),this.showInfo=!1,this.currentPath&&this.currentPath.setData([]),this.amap.clearMap(),this.amap.setCenter([n[0].fixx,n[0].fixy]);for(var a in n)this.addMarkerDefault(n[a]);this.amap.add(this.curMarkers),1===this.tabIndex?this.drawLines():0===this.tabIndex&&this.drawArrows(n)},drawLines:function(){var n=this;AMapUI.load(["ui/misc/PathSimplifier","lib/$"],function(t,a){if(!t.supportCanvas)return void alert("当前环境不支持 Canvas！");var e={lineWidth:3,strokeStyle:"#ec2422",dirArrowStyle:!1};n.currentPath=new t({zIndex:100,map:n.amap,getPath:function(n,t){return n.path},renderOptions:{pathLineStyle:e,pathLineSelectedStyle:e,pathLineHoverStyle:e}});var i=[];for(var s in n.dataCoords)i.push([n.dataCoords[s].fixx,n.dataCoords[s].fixy]);n.currentPath.setData([{path:i}]),n.currentPath.createPathNavigator(0,{loop:!0,speed:7}).start()})},drawArrows:function(n){for(var t=[],a=null,e=0;e<n.length;e++)n[e].personid===this.pid?a=[n[e].fixx,n[e].fixy]:t.push([n[e].fixx,n[e].fixy]);var i=[];for(var s in t)i[s]=new AMap.Polyline({path:[a,t[s]],showDir:!0,strokeColor:"#f60b0b",strokeWeight:4});this.amap.add(i),this.amap.setFitView()},actionMove:function(n){this.curAction="move"},actionClear:function(n){this.curAction="move",this.clearLayers()},actionDraw:function(n){this.curAction="draw",this.cradius=0},drawStart:function(n){this.touchstartx=n.changedTouches[0].clientX,this.touchstarty=n.changedTouches[0].clientY,this.clearLayers(),this.filterIndex=0,this.tabIndex=0},drawEnd:function(n){if(this.touchendx=n.changedTouches[0].clientX,this.touchendy=n.changedTouches[0].clientY,!(this.touchendx-this.touchstartx<4||this.touchendy-this.touchstarty<4)){var t=this,a=this.amap.containTolnglat(new AMap.Pixel(parseInt(this.touchstartx),parseInt(this.touchstarty)));this.mapcircle=new AMap.Circle({map:t.amap,center:a,radius:this.cradius*t.amap.getResolution(a),strokeColor:"#d098fd",strokeOpacity:.5,fillColor:"#fff",fillOpacity:.5,strokeWeight:2});var e=document.querySelector("#mycanvas");e.getContext("2d").clearRect(0,0,e.width,e.height),this.curAction="move",this.getDataInCircle()}},drawMove:function(n){var t=n.changedTouches[0].clientX,a=n.changedTouches[0].clientY,e=document.querySelector("#mycanvas"),i=Math.abs(t-this.touchstartx),s=Math.abs(a-this.touchstarty);this.cradius=Math.max(i,s);var r=e.getContext("2d");r.clearRect(0,0,e.width,e.height),r.beginPath(),r.arc(this.touchstartx,this.touchstarty,this.cradius,0,2*Math.PI),r.strokeStyle="#d098fd",r.lineWidth=2,r.stroke(),r.fillStyle="#fff",r.globalAlpha=.5,r.fill()},getDataInCircle:function(){var n=this,t={fixx:this.mapcircle.getCenter().lng,fixy:this.mapcircle.getCenter().lat,unitcode:this.unitcode,radius:this.mapcircle.getRadius()};console.log(t),this.publicApi.ajax(this.URL.DETAIL.CIRCLELOC,t,1).then(function(t){var a=t.data.data.list;if(a.length>0){for(var e in a)n.addMarkerDefault(a[e]);n.amap.add(n.curMarkers)}else n.$vux.toast.text("暂无数据！")})},clearLayers:function(){for(var n in this.curMarkers)this.curMarkers[n].off("touchend"),this.curMarkers[n]=null;this.curMarkers=[],this.currentMarker&&(this.currentMarker.off("touchend"),this.currentMarker=null),this.showInfo=!1,this.currentPath&&this.currentPath.setData([]),this.mapcircle&&this.amap.remove(this.mapcircle),this.mapcircle=null,this.amap.clearMap()},actionUploadLoc:function(){this.ageo.getCurrentPosition()}}}),h=function(){var n=this,t=n.$createElement,a=n._self._c||t;return a("div",[a("m-header",{staticClass:"g-header-transparent",attrs:{mTitle:n.cTitle}}),n._v(" "),a("div",{staticClass:"ju-map"},[a("div",{attrs:{id:"amap"}}),n._v(" "),a("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[a("loading",{attrs:{show:n.loadingMap,text:n.loadingText}})],1),n._v(" "),"LocShare"!==n.pageType?[a("div",{directives:[{name:"show",rawName:"v-show",value:1===n.tabIndex,expression:"tabIndex===1"}],staticClass:"date-opts"},[a("span",{staticClass:"vux-1px-b",class:{active:0===n.filterIndex},on:{click:function(t){n.changeFilterDay(0)}}},[n._v("当日")]),n._v(" "),a("span",{staticClass:"vux-1px-b",class:{active:3===n.filterIndex},on:{click:function(t){n.changeFilterDay(3)}}},[n._v("三日")]),n._v(" "),a("span",{class:{active:7===n.filterIndex},on:{click:function(t){n.changeFilterDay(7)}}},[n._v("七日")])]),n._v(" "),a("ul",{staticClass:"tabs"},[a("li",{class:{active:0===n.tabIndex},on:{click:function(t){n.changeTab(0)}}},[n._v("实时监控")]),n._v(" "),a("li",{class:{active:1===n.tabIndex},on:{click:function(t){n.changeTab(1)}}},[n._v("历史轨迹")])]),n._v(" "),a("div",{staticClass:"draw-opts"},[a("span",{ref:"btndraw",staticClass:"btn-draw",class:{active:"draw"===n.curAction},on:{click:function(t){n.actionDraw(t)}}},[a("i",{staticClass:"iconfont icon-map-draw"})]),n._v(" "),a("span",{staticClass:"btn-move",class:{active:"move"===n.curAction},on:{click:function(t){n.actionMove(t)}}},[a("i",{staticClass:"iconfont icon-map-move"})]),n._v(" "),a("span",{staticClass:"btn-clear",class:{active:"clear"===n.curAction},on:{click:function(t){n.actionClear(t)}}},[n._v("清屏")]),n._v(" "),a("span",{staticClass:"vux-1px-l vux-1px-r"})])]:n._e(),n._v(" "),a("div",{staticClass:"info-pane",class:{show:n.showInfo}},["LocShare"===n.pageType?a("span",{staticClass:"btn-upload",on:{click:n.actionUploadLoc}},[n._v("上传")]):n._e(),n._v(" "),a("div",{staticClass:"baseinfo"},[a("p",{staticClass:"name"},[n._v(n._s(n.currentMarkerDetail.personname))]),n._v(" "),a("p",{staticClass:"type"},[n._v(n._s(n.currentMarkerDetail.type))])]),n._v(" "),a("ul",{staticClass:"detail"},[a("li",[n._m(0),n._v(" "+n._s(n.currentMarkerDetail.fixsite)+"\n        ")]),n._v(" "),a("li",[n._m(1),n._v(" "+n._s(n.currentMarkerDetail.fixtime)+"\n        ")])])]),n._v(" "),a("div",{ref:"drawmask",staticClass:"drawmask",class:{"z-show":"draw"===n.curAction},on:{touchstart:function(t){n.drawStart(t)},touchend:function(t){n.drawEnd(t)},touchmove:function(t){n.drawMove(t)}}},[a("canvas",{attrs:{id:"mycanvas",width:"798",height:"798"}})])],2)],1)},d=[function(){var n=this,t=n.$createElement,a=n._self._c||t;return a("span",[a("i",{staticClass:"iconfont icon-location"})])},function(){var n=this,t=n.$createElement,a=n._self._c||t;return a("span",[a("i",{staticClass:"iconfont icon-clock"})])}],f={render:h,staticRenderFns:d},p=f,v=a("VU/8"),m=e,g=v(l,p,!1,m,null,null);t.default=g.exports},gZsE:function(n,t,a){t=n.exports=a("FZ+f")(!1),t.push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])}});